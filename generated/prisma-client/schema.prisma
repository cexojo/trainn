datasource db {
  provider = "sqlite"
}

// Define custom output path for generated Prisma Client
generator client {
  provider   = "prisma-client-js"
  output     = "../generated/prisma-client"
  engineType = "client"
}

model TrainingBlock {
  isVisible   Boolean        @default(true)
  id          String         @id @default(uuid())
  blockNumber Int
  description String
  weeks       TrainingWeek[]
  user        User           @relation(fields: [userId], references: [id])
  userId      String
  createdAt   DateTime       @default(now())
}

model TrainingWeek {
  id                String              @id @default(uuid())
  block             TrainingBlock       @relation(fields: [blockId], references: [id])
  blockId           String
  weekNumber        Int
  weekStart         DateTime
  weekEnd           DateTime
  trainingDays      TrainingDay[]
  dayExerciseSeries DayExerciseSeries[]
}

model TrainingDay {
  id           String        @id @default(uuid())
  date         DateTime
  dayLabel     String
  dayNumber    Int
  week         TrainingWeek  @relation(fields: [weekId], references: [id])
  weekId       String
  dayExercises DayExercise[]
}

model ExerciseGroup {
  id        String     @id @default(uuid())
  name      String     @unique
  exercises Exercise[]
}

enum MeasurementType {
  REPS
  TIME
}

model Exercise {
  id                  String          @id @default(uuid())
  name                String          @unique
  exerciseGroup       ExerciseGroup   @relation(fields: [exerciseGroupId], references: [id])
  exerciseGroupId     String
  recommendedMinReps  Int?
  recommendedMaxReps  Int?
  measurementType     MeasurementType @default(REPS)
  dayExercises        DayExercise[]
  factorQuadriceps    Float?
  factorHamstring     Float?
  factorGlute         Float?
  factorAdductor      Float?
  factorCalf          Float?
  factorForearm       Float?
  factorBiceps        Float?
  factorTriceps       Float?
  factorLateralDelt   Float?
  factorPosteriorDelt Float?
  factorAnteriorDelt  Float?
  factorPectoral      Float?
  factorClavicularPec Float?
  factorUpperBack     Float?
  factorLat           Float?
  factorLowerBack     Float?
  factorAbdomen       Float?
}

enum Role {
  admin
  athlete
}

enum Sex {
  MALE
  FEMALE
}

model User {
  id                    String          @id @default(uuid())
  firstName             String
  lastName              String
  username              String          @unique
  email                 String          @unique
  password              String?
  passwordRefreshToken  String?         @unique
  isocode               String?
  lastVisitedWeek       String? // weekId of last visited week
  registrationDate      DateTime        @default(now())
  hidingDate            DateTime?
  subscriptionAmount    Float?
  subscriptionFrequency String?
  blocks                TrainingBlock[]
  role                  Role            @default(athlete)
  payments              Payment[]
  measurements          Measurement[]
  hidden                Boolean         @default(false)
  lastOKLogin           DateTime?
  lastKOLogin           DateTime?
  sex                   Sex?
}

// New middle entity between TrainingDay and Exercise
model DayExercise {
  id             String              @id @default(uuid())
  trainingDay    TrainingDay         @relation(fields: [trainingDayId], references: [id])
  trainingDayId  String
  exercise       Exercise            @relation(fields: [exerciseId], references: [id])
  exerciseId     String
  athleteNotes   String?
  trainerNotes   String?
  day            String
  exerciseNumber Int?
  series         DayExerciseSeries[]
}

// Renamed, now links to DayExercise
model DayExerciseSeries {
  id              String       @id @default(uuid())
  dayExercise     DayExercise  @relation(fields: [dayExerciseId], references: [id])
  dayExerciseId   String
  seriesNumber    Int
  minReps         Int?
  maxReps         Int?
  minRir          Int?
  maxRir          Int?
  effectiveReps   Int?
  effectiveWeight Float?
  effectiveRir    Int?
  trainingWeek    TrainingWeek @relation(fields: [trainingWeekId], references: [id])
  trainingWeekId  String
  isDropset       Boolean      @default(false)
  athleteNotes    String?
  trainerNotes    String?
  athleteUserRead Boolean      @default(false)
}

model Payment {
  id      String   @id @default(uuid())
  user    User     @relation(fields: [userId], references: [id])
  userId  String
  dueDate DateTime
  amount  Float
  isPayed Boolean  @default(false)
}

model Measurement {
  id         String   @id @default(uuid())
  user       User     @relation(fields: [userId], references: [id])
  userId     String
  date       DateTime
  weight     Float?
  neck       Float?
  arm        Float?
  waist      Float?
  abdomen    Float?
  hip        Float?
  thigh      Float?
  calfMuscle Float?
}
