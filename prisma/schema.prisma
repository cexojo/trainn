// Define database connection via the `DATABASE_URL` env var
datasource db {
  provider = "postgresql"
}

// Define custom output path for generated Prisma Client
generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma-client"
  engineType      = "client"
}

model TrainingBlock {
  isVisible   Boolean   @default(true)
  id          String        @id @default(uuid())
  blockNumber Int
  description String
  weeks       TrainingWeek[]
  user        User          @relation(fields: [userId], references: [id])
  userId      String
}

model TrainingWeek {
  id           String        @id @default(uuid())
  block        TrainingBlock @relation(fields: [blockId], references: [id])
  blockId      String
  weekNumber   Int
  weekStart    DateTime
  weekEnd      DateTime
  trainingDays TrainingDay[]
  dayExerciseSeries DayExerciseSeries[]
}

model TrainingDay {
  id           String      @id @default(uuid())
  date         DateTime
  dayLabel     String
  dayNumber    Int
  week         TrainingWeek @relation(fields: [weekId], references: [id])
  weekId       String
  dayExercises DayExercise[]
}

model Exercise {
  id           String   @id @default(uuid())
  name         String   @unique
  group        String
  dayExercises DayExercise[]
}

enum Role {
  admin
  athlete
}

model User {
  id                String   @id @default(uuid())
  name              String
  username          String   @unique
  email             String   @unique
  password          String?
  isocode           String?
  lastVisitedWeek   String?  // weekId of last visited week
  blocks            TrainingBlock[]
  role              Role     @default(athlete)
  payments          Payment[]
}

// New middle entity between TrainingDay and Exercise
model DayExercise {
  id             String    @id @default(uuid())
  trainingDay    TrainingDay @relation(fields: [trainingDayId], references: [id])
  trainingDayId  String
  exercise       Exercise    @relation(fields: [exerciseId], references: [id])
  exerciseId     String
  athleteNotes   String?
  trainerNotes   String?
  day            String
  exerciseNumber Int?
  series         DayExerciseSeries[]
}

// Renamed, now links to DayExercise
model DayExerciseSeries {
  id                String    @id @default(uuid())
  dayExercise       DayExercise @relation(fields: [dayExerciseId], references: [id])
  dayExerciseId     String
  seriesNumber      Int
  minReps           Int
  maxReps           Int
  minRir            Int
  maxRir            Int
  effectiveReps     Int?
  effectiveWeight   Float?
  effectiveRir      Int?
  trainingWeek      TrainingWeek @relation(fields: [trainingWeekId], references: [id])
  trainingWeekId    String
  isDropset         Boolean      @default(false)
}

model Payment {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  dueDate   DateTime
  amount    Float
  isPayed   Boolean  @default(false)
}
